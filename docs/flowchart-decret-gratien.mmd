flowchart TD
    %% ========================================
    %% MODULE SP√âCIAL - D√âCRET DE GRATIEN
    %% ========================================

    START([‚öñÔ∏è MODULE SP√âCIAL<br/>D√©cret de Gratien])

    %% ========================================
    %% ENTR√âES PARALL√àLES
    %% ========================================
    INPUT1[üì• Entr√©e 1:<br/>XML Pages depuis MODULE 4<br/>Transcriptions brutes]
    INPUT2[üì• Entr√©e 2:<br/>Version finale MODULE 5<br/>Transcriptions nettoy√©es]

    START --> INPUT1
    START --> INPUT2

    %% ========================================
    %% BRANCHE 1 - ALL√âGATIONS
    %% ========================================
    subgraph ALLEGATIONS_FLOW [üìä Workflow All√©gations]
        AL_SOURCE[üìö Source:<br/>Ochoa et Diez<br/>Recueil d'All√©gations<br/>historique]
        AL_ALGO[‚öôÔ∏è Algorithme<br/>d'extraction]
        AL_CSV_BRUT[üìÑ CSV Brut:<br/>Num√©ro all√©gation<br/>+ suffixe]
        AL_AJOUT_ID[üî¢ Ajout d'ID unique<br/>pour chaque all√©gation]
        AL_CORRECTION[‚úçÔ∏è Correction et<br/>Enrichissement<br/>des all√©gations]
        AL_VALIDATION[‚úÖ Validation<br/>des donn√©es]
        AL_FINAL[üìä All√©gations.csv<br/>Version finale]

        AL_SOURCE --> AL_ALGO
        AL_ALGO --> AL_CSV_BRUT
        AL_CSV_BRUT --> AL_AJOUT_ID
        AL_AJOUT_ID --> AL_CORRECTION
        AL_CORRECTION --> AL_VALIDATION
        AL_VALIDATION --> AL_FINAL
    end

    INPUT1 --> AL_SOURCE

    %% ========================================
    %% BRANCHE 2 - FRIEDBERG & M√úNCHENER
    %% ========================================
    subgraph FRIEDBERG_FLOW [üìñ Workflow Friedberg & M√ºnchener]
        FR_SOURCE1[üìÑ XML Page + Images<br/>D√©cret de Gratien<br/>√âdition Friedberg]
        FR_SOURCE2[üåê Site Web:<br/>M√ºnchener Digitale<br/>Bibliothek]

        FR_MERGE[üîó Fusion des sources<br/>Texte int√©gral<br/>de la version]

        FR_EXTRACTION[üì§ Extraction<br/>de tous les canons<br/>au format .txt]

        FR_REPARTITION[üìÅ R√©partition des canons<br/>dans dossiers/sous-dossiers<br/>selon logique du D√©cret]

        FR_STRUCTURE[üóÇÔ∏è Structure hi√©rarchique:<br/>Parties ‚Üí Distinctions ‚Üí<br/>Causae ‚Üí Quaestiones]

        FR_AJOUT_ID[üî¢ Ajout ID correspondant<br/>pour chaque canon<br/>selon All√©gations.csv]

        FR_ENRICHISSEMENT[‚ú® Enrichissement<br/>m√©tadonn√©es]

        FR_VALIDATION[‚úÖ Validation<br/>structure + contenu]

        FR_FINAL[‚öñÔ∏è D√©cret de Gratien<br/>enrichi et structur√©]

        FR_SOURCE1 --> FR_MERGE
        FR_SOURCE2 --> FR_MERGE
        FR_MERGE --> FR_EXTRACTION
        FR_EXTRACTION --> FR_REPARTITION
        FR_REPARTITION --> FR_STRUCTURE
        FR_STRUCTURE --> FR_AJOUT_ID
        FR_AJOUT_ID --> FR_ENRICHISSEMENT
        FR_ENRICHISSEMENT --> FR_VALIDATION
        FR_VALIDATION --> FR_FINAL
    end

    INPUT2 --> FR_SOURCE1

    %% ========================================
    %% CONNEXION ENTRE LES BRANCHES
    %% ========================================
    AL_FINAL -->|Mapping ID| FR_AJOUT_ID

    %% ========================================
    %% SORTIE FINALE
    %% ========================================
    CONVERGENCE[üì¶ Donn√©es enrichies<br/>D√©cret de Gratien complet]

    FR_FINAL --> CONVERGENCE
    AL_FINAL -.->|Donn√©es r√©f√©rence| CONVERGENCE

    OUTPUT([üéØ SORTIE FINALE<br/>Corpus D√©cret de Gratien])

    CONVERGENCE --> OUTPUT

    %% ========================================
    %% D√âTAIL STRUCTURE D√âCRET
    %% ========================================
    subgraph STRUCTURE_DETAIL [üóÇÔ∏è Structure du D√©cret de Gratien]
        STRUCT_TITLE[üìã Organisation hi√©rarchique]

        STRUCT_P1[Partie I:<br/>Distinctions 1-101<br/>Sources du droit canon]
        STRUCT_P2[Partie II:<br/>Causae 1-36<br/>Cas juridiques<br/>avec Quaestiones]
        STRUCT_P3[Partie III:<br/>De Consecratione<br/>Distinctions 1-5<br/>Liturgie et sacrements]

        STRUCT_TITLE --> STRUCT_P1
        STRUCT_TITLE --> STRUCT_P2
        STRUCT_TITLE --> STRUCT_P3
    end

    %% ========================================
    %% D√âTAIL ALL√âGATIONS
    %% ========================================
    subgraph ALLEGATIONS_DETAIL [üìä Types d'All√©gations]
        ALLEG_TITLE[üìã Cat√©gories]

        ALLEG_CANON[Canons conciliaires:<br/>D√©cisions des conciles]
        ALLEG_DECRET[D√©cr√©tales pontificales:<br/>Lettres des papes]
        ALLEG_PERES[P√®res de l'√âglise:<br/>Citations patristiques]
        ALLEG_BIBLE[Textes bibliques:<br/>R√©f√©rences scripturaires]

        ALLEG_TITLE --> ALLEG_CANON
        ALLEG_TITLE --> ALLEG_DECRET
        ALLEG_TITLE --> ALLEG_PERES
        ALLEG_TITLE --> ALLEG_BIBLE
    end

    %% ========================================
    %% ANNOTATIONS
    %% ========================================
    note1[üí° Ochoa et Diez:<br/>R√©f√©rence acad√©mique<br/>Catalogue des sources<br/>du D√©cret]
    note2[üí° Friedberg:<br/>√âdition critique standard<br/>1879-1881<br/>Corpus Iuris Canonici]
    note3[üí° M√ºnchener:<br/>Version num√©ris√©e<br/>Acc√®s web gratuit<br/>Texte extractible]
    note4[üí° Algorithme extraction:<br/>Parsing intelligent<br/>Reconnaissance structure<br/>Python + Regex]
    note5[üí° ID unique:<br/>Tra√ßabilit√© compl√®te<br/>Lien all√©gation ‚Üî canon<br/>Format: DG_PXXX_DXXX_CXXX]

    AL_SOURCE -.-> note1
    FR_SOURCE1 -.-> note2
    FR_SOURCE2 -.-> note3
    AL_ALGO -.-> note4
    AL_AJOUT_ID -.-> note5

    %% ========================================
    %% STATISTIQUES
    %% ========================================
    subgraph STATS [üìä Statistiques Indicatives]
        S1[~4000 canons dans le D√©cret]
        S2[~3800 all√©gations recens√©es]
        S3[~150 distinctions au total]
        S4[~36 causae avec ~150 quaestiones]
        S5[Taille finale: ~2-3 GB]
    end

    %% ========================================
    %% OUTILS
    %% ========================================
    subgraph TOOLS [üõ†Ô∏è Outils Utilis√©s]
        T1[Python: Scripts extraction]
        T2[BeautifulSoup: Scraping web]
        T3[Pandas: Manipulation CSV]
        T4[lxml: Traitement XML]
        T5[Regex: Parsing texte]
    end

    %% ========================================
    %% STYLES
    %% ========================================
    classDef startEnd fill:#4caf50,stroke:#2e7d32,stroke-width:3px,color:#fff
    classDef input fill:#e3f2fd,stroke:#1565c0,stroke-width:2px
    classDef allegations fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef friedberg fill:#f3e5f5,stroke:#8e24aa,stroke-width:2px
    classDef source fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    classDef algorithme fill:#ffccbc,stroke:#d84315,stroke-width:2px
    classDef validation fill:#b2dfdb,stroke:#00796b,stroke-width:2px
    classDef final fill:#a5d6a7,stroke:#2e7d32,stroke-width:3px
    classDef convergence fill:#c8e6c9,stroke:#388e3c,stroke-width:3px
    classDef note fill:#fff9c4,stroke:#f57f17,stroke-width:1px,stroke-dasharray: 5 5
    classDef title fill:#e0e0e0,stroke:#757575,stroke-width:2px

    class START,OUTPUT startEnd
    class INPUT1,INPUT2 input
    class AL_SOURCE,AL_CSV_BRUT,AL_AJOUT_ID,AL_CORRECTION,AL_FINAL allegations
    class FR_SOURCE1,FR_SOURCE2,FR_MERGE,FR_EXTRACTION,FR_REPARTITION,FR_STRUCTURE,FR_AJOUT_ID,FR_ENRICHISSEMENT,FR_FINAL friedberg
    class AL_ALGO,FR_MERGE algorithme
    class AL_VALIDATION,FR_VALIDATION validation
    class AL_FINAL,FR_FINAL final
    class CONVERGENCE convergence
    class note1,note2,note3,note4,note5 note
    class STRUCT_TITLE,ALLEG_TITLE title

    style ALLEGATIONS_FLOW fill:#fff8e1,stroke:#f57f17,stroke-width:2px
    style FRIEDBERG_FLOW fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    style STRUCTURE_DETAIL fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px,stroke-dasharray: 5 5
    style ALLEGATIONS_DETAIL fill:#e1f5fe,stroke:#0288d1,stroke-width:2px,stroke-dasharray: 5 5
    style STATS fill:#f5f5f5,stroke:#616161,stroke-width:2px,stroke-dasharray: 3 3
    style TOOLS fill:#e0f2f1,stroke:#00796b,stroke-width:2px,stroke-dasharray: 3 3
